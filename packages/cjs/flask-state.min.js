/** @license flask-state
 * flask-state.js
 *
 * Copyright (c) 2020, yoobool
 *
 * This source code is licensed under the BSD-3 license found in the
 * LICENSE file in the root directory of this source tree.
 */

'use strict';



module.exports=function(e){var t={};function s(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,a){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(a,n,function(t){return e[t]}.bind(null,n));return a},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t){!function(){"use strict";const e=85,s=75,a=10,n=5,i=1048576;class o{constructor(e){this.language=e,this.mobile=o.isMobile(),this.index=0,this.ajax=new l,this.initFlaskStateContainer(this.mobile),this.setEventListener(),this.initFlaskStateLanguage(this.language),this.setInitParams(),this.mobile&&this.setTagChangeEventListener(this.consoleCpuChart,this.consoleMemoryChart,this.consoleLoadavgChart,this.consoleDiskusageChart),window.onresize=()=>o.resizeChartTimer([this.consoleMemoryChart,this.consoleCpuChart,this.consoleLoadavgChart,this.consoleDiskusageChart])}setFlaskStateData(){document.getElementById("fs-info-back").style.display="block",document.getElementById("fs-info-container").style.display="block",document.getElementsByTagName("body")[0].style.overflowX="hidden",document.getElementsByTagName("body")[0].style.overflowY="hidden",document.getElementById("fs-select-days").value="1",this.setCharts("1")}initFlaskStateContainer(){let e='<div class="flask-state-elem layer console-info-back-style" id="fs-info-back" disabled="disabled" xmlns="http://www.w3.org/1999/html"></div><div class="flask-state-elem "><div class="flask-state-elem console-info-container-style console-info-container-box box-style " id="fs-info-container"><div class="flask-state-elem fs-select-container"><select id="fs-select-days" class="margin-right-3"><option value="1">1</option><option value="3">3</option><option value="7">7</option><option value="30">30</option></select><span id="fs-days">days</span></div><button type="button" class="flask-state-elem console-info-close-style" id="fs-info-close"><span>&times;</span></button><h4 id="fs-host-status-title" class="flask-state-elem fs-font-box box-style no-padding margin-top-10 fs-h4-style">host_status</h4><div id="fs-host-status" class="flask-state-elem fs-font-box box-style no-padding"><span id="fs-memory" class="margin-right-5">memory:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-cpu" class="margin-right-5">cpu:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-disk-usage" class="margin-right-5">disk_usage:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-load-avg" class="margin-right-5">LoadAvg:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-boot-seconds" class="margin-right-5">boot_seconds:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span></div><h4 id="fs-redis-status-title" class="flask-state-elem fs-font-box box-style no-padding fs-h4-style">redis_status</h4><div id="fs-redis-status" class="flask-state-elem fs-font-box box-style no-padding margin-bottom-10 "><span id="fs-used-memory" class="margin-right-5">used_memory:</span><span class="flask-state-elem fs-badge-style margin-top-m3 no-padding fontsize-18 console-info-memory-text margin-right-10"></span><span id="fs-used-memory-rss" class="margin-right-5">used_memory_rss:</span><span class="flask-state-elem fs-badge-style margin-top-m3 no-padding fontsize-18 console-info-memory-text margin-right-10"></span><span id="fs-mem-fragmentation-ratio" class="margin-right-5">mem_fragmentation_ratio:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-hits-ratio" class="margin-right-5">hits_ratio:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-delta-hits-ratio" class="margin-right-5">24h_hits_ratio:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-uptime-in-seconds" class="margin-right-5">uptime_in_seconds:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span><span id="fs-connected-clients" class="margin-right-5">connected_clients:</span><span class="flask-state-elem fs-badge-style background-green margin-top-m3 margin-right-10"></span></div>';this.mobile?e+='<hr id="console-info-line" class="console-info-line-style"><div class="flask-state-elem fs-ul-tabs-box no-margin "><ul id="fs-info-tab" class="flask-state-elem fs-ul-tabs"><li class="flask-state-elem active"><a href="#console_info_tab_memory" data-toggle="tab"><strong>memory</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_cpu" data-toggle="tab"><strong>cpu</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_diskusage" data-toggle="tab"><strong>disk_usage</strong></a></li><li class="flask-state-elem"><a href="#console_info_tab_loadavg" data-toggle="tab"><strong>LoadAvg</strong></a></li></ul><div class="flask-state-elem form-group no-margin "><div class="flask-state-elem state-tab-content "><div id="fs-info-tab-memory" class="flask-state-elem state-tab-pane fs-show"><div><div id="fs-info-memory-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-cpu" class="flask-state-elem state-tab-pane "><div><div id="fs-info-cpu-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-disk-usage" class="flask-state-elem state-tab-pane "><div><div id="fs-info-diskusage-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div><div id="fs-info-tab-loadavg" class="flask-state-elem state-tab-pane"><div><div id="fs-info-loadavg-chart" class="flask-state-elem margin-top-10 fs-chart-style"></div></div></div></div></div></div></div></div>':e+="<div class='flask-state-elem fs-charts-box box-style no-padding console-info-border-r'><div class='flask-state-elem charts-box-info'><div id='fs-info-memory-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding '><div class='flask-state-elem charts-box-info'><div id='fs-info-cpu-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding console-info-border-r '><div class='flask-state-elem charts-box-info'><div id='fs-info-diskusage-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div><div class='flask-state-elem fs-charts-box box-style no-padding'><div class='flask-state-elem charts-box-info'><div id='fs-info-loadavg-chart' class='flask-state-elem margin-top-10 fs-chart-style'></div></div></div></div></div>",document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",e)}setEventListener(){if(window.addEventListener){document.getElementById("fs-info-close").addEventListener("click",(function(){document.getElementById("fs-info-back").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out")})),document.getElementById("fs-info-back").addEventListener("click",(function(){document.getElementById("fs-info-back").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out")}));let e=document.getElementById("fs-select-days");e.addEventListener("change",(()=>{this.setCharts(e.value)}))}}setTagChangeEventListener(...e){if(document.getElementById("fs-info-tab")){let t=document.getElementById("fs-info-tab").getElementsByTagName("li"),s=document.getElementById("fs-info-tab-memory"),a=t[0],n=0;const i={0:"fs-info-tab-memory",1:"fs-info-tab-cpu",2:"fs-info-tab-disk-usage",3:"fs-info-tab-loadavg"};for(let l of t){let t=document.getElementById(i[n]);l.children[0].addEventListener("click",(()=>{l.classList.add("active"),a.classList.remove("active"),s.classList.remove("fs-show"),t.classList.add("fs-show"),o.resizeChart(e),s=t,a=l})),n++}}}initFlaskStateLanguage(){0!==Object.keys(this.language).length&&(document.getElementById("fs-host-status-title").innerHTML=this.language.host_status+":",document.getElementById("fs-redis-status-title").innerHTML=this.language.redis_status+":",document.getElementById("fs-cpu").innerHTML=this.language.cpu+":",document.getElementById("fs-memory").innerHTML=this.language.memory+":",document.getElementById("fs-disk-usage").innerHTML=this.language.disk_usage+":",document.getElementById("fs-load-avg").innerHTML=this.language.load_avg+":",document.getElementById("fs-boot-seconds").innerHTML=this.language.boot_seconds+":",document.getElementById("fs-used-memory").innerHTML=this.language.used_memory+":",document.getElementById("fs-used-memory-rss").innerHTML=this.language.used_memory_rss+":",document.getElementById("fs-mem-fragmentation-ratio").innerHTML=this.language.mem_fragmentation_ratio+":",document.getElementById("fs-hits-ratio").innerHTML=this.language.hits_ratio+":",document.getElementById("fs-delta-hits-ratio").innerHTML=this.language.delta_hits_ratio+":",document.getElementById("fs-uptime-in-seconds").innerHTML=this.language.uptime_in_seconds+":",document.getElementById("fs-connected-clients").innerHTML=this.language.connected_clients+":",document.getElementById("fs-days").innerHTML=this.language.days)}setInitParams(){this.consoleCpuChart=echarts.init(document.getElementById("fs-info-cpu-chart"),null,{renderer:"svg"}),this.consoleMemoryChart=echarts.init(document.getElementById("fs-info-memory-chart"),null,{renderer:"svg"}),this.consoleLoadavgChart=echarts.init(document.getElementById("fs-info-loadavg-chart"),null,{renderer:"svg"}),this.consoleDiskusageChart=echarts.init(document.getElementById("fs-info-diskusage-chart"),null,{renderer:"svg"}),this.cpuOption=o.generateChatOption(this.mobile,this.language.cpu||"CPU","",this.language.today),this.memoryOption=o.generateChatOption(this.mobile,this.language.memory||"Memory","",this.language.today),this.diskUsageOption=o.generateChatOption(this.mobile,this.language.disk_usage||"DiskUsage","",this.language.today),this.loadavgOption=o.generateChatOption(this.mobile,"Load Avg","loadavg",this.language.minutes)}setCharts(t){this.consoleCpuChart.showLoading(),this.consoleMemoryChart.showLoading(),this.consoleLoadavgChart.showLoading(),this.consoleDiskusageChart.showLoading(),this.ajax.send({type:"POST",url:"/v0/state/hoststatus",data:{timeQuantum:t},success:t=>{const l=["ts","cpu","memory","load_avg","disk_usage"],r=t.data;r.items=r.items.map((e=>{let t={};return l.forEach(((s,a)=>{if("ts"===s)return t[s]=1e3*e[a];t[s]=e[a]})),t}));let d=r.currentStatistic;if(Object.keys(d).length){let t=document.getElementById("fs-host-status").getElementsByClassName("fs-badge-style");t[0].innerHTML=d.memory+"%",t[1].innerHTML=d.cpu+"%",t[2].innerHTML=d.disk_usage+"%",t[3].innerHTML=d.load_avg[0]+"，"+d.load_avg[1]+"，"+d.load_avg[2],d.boot_seconds&&(t[4].innerHTML=o.getFormatSeconds(d.boot_seconds,this.language.days,this.language.hours,this.language.minutes,this.language.seconds));["memory","cpu","disk_usage","load_avg"].forEach((function(i,o){let l="";if("load_avg"===i){let e=(d.load_avg[0]+d.load_avg[1]+d.load_avg[2])/3;l=e>=n?e>=a?"background-red":"background-orange":"background-green"}else l=d[i]>=s?d.memory>=e?"background-red":"background-orange":"background-green";let r=t[o].classList;r.remove("background-green","background-orange","background-red"),r.add(l)}));let l=document.getElementById("fs-redis-status").getElementsByClassName("fs-badge-style"),r=["used_memory","used_memory_rss","mem_fragmentation_ratio","hits_ratio","delta_hits_ratio","uptime_in_seconds","connected_clients"],c=!0;for(let e in r)if(d[e]){c=!1;break}c?(document.getElementById("fs-redis-status-title").innerHTML="",document.getElementById("fs-redis-status-title").style.marginTop=0,document.getElementById("fs-redis-status").style.display="none"):r.forEach(((e,t)=>{switch(e){case"used_memory":case"used_memory_rss":l[t].innerHTML=Math.ceil(d[e]/i)+"M";break;case"mem_fragmentation_ratio":let s=d[e];if(l[t].innerHTML=d[e],null!=s&&s>1){let e=l[t].classList;e.remove("background-green"),e.add("background-red")}break;case"hits_ratio":case"delta_hits_ratio":l[t].innerHTML=d[e]+"%";break;case"uptime_in_seconds":l[t].innerHTML=o.getFormatSeconds(d[e],this.language.days,this.language.hours,this.language.minutes,this.language.seconds);break;case"connected_clients":l[t].innerHTML=d[e]}}))}r.items.reverse();let c=o.getChartsData(r.items),m=c.ts_list,g=c.cpu_list,u=c.memory_list,f=c.load_avg_list[0],h=c.load_avg_list[1],p=c.load_avg_list[2],y=c.disk_usage_list;this.memoryOption.xAxis.data=m,this.cpuOption.xAxis.data=m,this.loadavgOption.xAxis.data=m,this.diskUsageOption.xAxis.data=m,this.memoryOption.series[0].data=u,this.cpuOption.series[0].data=g,this.diskUsageOption.series[0].data=y,this.loadavgOption.series[0].data=f,this.loadavgOption.series[1].data=h,this.loadavgOption.series[2].data=p,this.consoleMemoryChart.setOption(this.memoryOption),this.consoleCpuChart.setOption(this.cpuOption),this.consoleLoadavgChart.setOption(this.loadavgOption),this.consoleDiskusageChart.setOption(this.diskUsageOption),o.resizeChart([this.consoleMemoryChart,this.consoleCpuChart,this.consoleLoadavgChart,this.consoleDiskusageChart])},complete:()=>{this.consoleMemoryChart.hideLoading(),this.consoleCpuChart.hideLoading(),this.consoleLoadavgChart.hideLoading(),this.consoleDiskusageChart.hideLoading()}}).then()}static isMobile(){let e=navigator.userAgent,t={trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML"),mobile:e.match(/AppleWebKit.*Mobile.*/)&&!0,ios:e.match(/\(i[^;]+;( U;)? CPU.Mac OS X/)&&!0,android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1===e.indexOf("Safari"),wechat:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)&&" qq"===e.match(/\sQQ/i)[0]};return t.iPhone||t.iPad||t.webApp||t.wechat||t.qq||t.ios||t.mobile||!1}static resizeChartTimer(e,t){clearTimeout(this.clearId),this.clearId=setTimeout((function(){o.resizeChart(e)}),t||200)}static resizeChart(e){e.forEach((e=>e.resize()))}static generateChatOption(e,t,s="",a=""){let n={color:"loadavg"===s?["#ffa726","#42a5f5","#66bb6a"]:["#42a5f5"],title:{show:!e,text:t},tooltip:{trigger:"axis",formatter:e=>{let t=echarts.format.formatTime("yyyy-MM-dd hh:mm:ss",new Date(parseInt(e[0].axisValue)),!1)+"<br />";for(let a=0;a<e.length;a++)t+=e[a].marker+e[a].seriesName+": "+e[a].value+("loadavg"===s?"":"%")+"<br />";return t}},legend:{data:[a],textStyle:{fontSize:14}},grid:{left:"3%",right:"4%",bottom:"3%",top:e?30:60,containLabel:!0},toolbox:{show:!e,feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,axisLabel:{formatter:function(e){return echarts.format.formatTime("hh:mm",new Date(parseInt(e)),!1)}}},yAxis:{type:"value"},series:[{name:a,type:"line",symbol:"none",hoverAnimation:!1}]};return"loadavg"===s&&(n.legend.data=["1"+a,"5"+a,"15"+a],n.series=[],n.legend.data.forEach((e=>{n.series.push({name:e,type:"line",symbol:"none",hoverAnimation:!1})}))),n}static getChartsData(e){let t=[],s=[],a=[],n=[],i=[],o=[],l=[];for(let r=0;r<e.length;r++){let d=e[r];t.push(d.cpu),s.push(d.disk_usage),a.push(d.load_avg[0]),n.push(d.load_avg[1]),i.push(d.load_avg[2]),o.push(d.memory),l.push(d.ts)}return{cpu_list:t,disk_usage_list:s,load_avg_list:[a,n,i],memory_list:o,ts_list:l}}static getFormatSeconds(e,t="days",s="hours",a="minutes",n="seconds"){let i=parseInt(e),o=0,l=0,r=0,d="";return i>=60?(o=i/60,o>=60&&(l=o/60,o%=60),l>=24&&(r=l/24,l%=24)):d=i+n,o>0&&(d=Math.floor(o)+a),l>0&&(d=Math.floor(l)+s),r>0&&(d=Math.floor(r)+t),d}}class l{constructor(e){e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xhr=e}send(e){let t=this.xhr,s={type:e.type||"get",url:e.url||"",async:e.async||!0,data:JSON.stringify(e.data),dataType:e.dataType||"json",contentType:"application/json",success:e.success||null,complete:e.complete||null};return new Promise(((e,a)=>{t.open(s.type,s.url,s.async),t.onreadystatechange=()=>{if(4===t.readyState)if(200===t.status){if("json"===s.dataType){const n=JSON.parse(t.responseText);e(n),null!==s.success?s.success(n):a(new Error(String(t.status)||"No callback function."))}}else a(new Error(String(t.status)||"Server is fail."))},t.onerror=()=>{a(new Error(String(t.status)||"Server is fail."))},t.setRequestHeader("Content-type",s.contentType),t.send(s.data),t.onloadend=()=>{null!=s.complete&&s.complete()}}))}}const r=function(){let e=null;return function(t){return e||(e=new o(t))}}();t.init=function(e){let t=null,s={};if(null!==e&&"object"==typeof e&&(t=e.hasOwnProperty("dom")?e.dom:null,s=e.hasOwnProperty("lang")&&e.lang.hasOwnProperty("language")?e.lang:{}),t instanceof HTMLElement){if(t.getAttribute("flaskState"))return;t.setAttribute("flaskState","true"),t.addEventListener("click",(()=>r(s).setFlaskStateData()))}else{if(document.getElementById("fs-state-circular"))return;let e="<div id='fs-state-circular' class='fs-circular fs-circular-animation' style='border-radius:100px;opacity:0.3;border:2px solid purple;'></div>",t=document.getElementsByTagName("body")[0];t.insertAdjacentHTML("beforeend",e);let a,n,i=document.getElementById("fs-state-circular");i.onclick=function(){this.classList.add("fs-circular-out"),r(s).setFlaskStateData()},i.onmousedown=function(e){n=n||e.clientY,i.classList.remove("fs-circular-animation"),a=setTimeout((function(){i.style.cursor="move",t.style.cursor="move",t.onmousemove=function(e){i.style.top=Math.max(e.clientY-n+300,20)+"px"}}),1500)},t.onmouseup=function(){i.style.cursor="pointer",i.classList.add("fs-circular-animation"),t.onmousemove=null,this.style.cursor="default",clearTimeout(a)},i.ontouchstart=function(e){n=n||e.clientY,i.classList.remove("fs-circular-animation"),a=setTimeout((function(){i.style.cursor="move",t.style.cursor="move",t.ontouchmove=function(e){i.style.top=Math.max(e.clientY-n+300,20)+"px"}}),1500)},t.ontouchend=function(){i.style.cursor="pointer",i.classList.add("fs-circular-animation"),t.ontouchmove=null,this.style.cursor="default",clearTimeout(a)}}}}()}]);