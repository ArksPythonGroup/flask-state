/** @license flask-state
 * flask-state.js
 *
 * Copyright (c) 2020, yoobool
 *
 * This source code is licensed under the BSD-3 license found in the
 * LICENSE file in the root directory of this source tree.
 */

'use strict';


!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.flaskState=t():e.flaskState=t()}(window,(function(){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,a),s.l=!0,s.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(n,s,function(t){return e[t]}.bind(null,s));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var s in t=arguments[a])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,a=t&&e[t],n=0;if(a)return a.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=85,i=75,r=10,d=5,l=1048576,c=null,u=function(){function e(t){var a=this;this.clearId=null,this.language=t,this.mobile=e.isMobile(),this.index=0,this.ajax=new m,this.initFlaskStateContainer(),this.setEventListener(),this.initFlaskStateLanguage(),this.setInitParams(),this.mobile&&this.setTagChangeEventListener(this.consoleCpuChart,this.consoleMemoryChart,this.consoleLoadavgChart,this.consoleDiskUsageChart),window.addEventListener("resize",(function(){a.resizeChartTimer([a.consoleMemoryChart,a.consoleCpuChart,a.consoleLoadavgChart,a.consoleDiskUsageChart])}))}return e.prototype.setFlaskStateData=function(){document.getElementById("fs-background").style.display="block",document.getElementById("fs-info-container").style.display="block",document.getElementsByTagName("body")[0].style.overflowX="hidden",document.getElementsByTagName("body")[0].style.overflowY="hidden",document.getElementById("fs-select-days").value="1",this.setCharts(1)},e.prototype.initFlaskStateContainer=function(){var e=this.mobile?v(v,null,v("hr",{id:"console-info-line",className:"console-info-line-style"}),v("ul",{id:"fs-info-tab",className:"fs-ul-tabs"},v("li",{className:"active"},v("a",{"data-toggle":"tab"}," ",v("strong",null,"Memory"))),v("li",null,v("a",{"data-toggle":"tab"},v("strong",null,"CPU"))),v("li",null,v("a",{"data-toggle":"tab"},v("strong",null,"Disk Usage"))),v("li",null,v("a",{"data-toggle":"tab"},v("strong",null,"Load Avg")))),v("div",{id:"fs-info-tab-memory",className:"fs-mChart-box fs-show"},v("div",{id:"fs-info-memory-chart",className:"fs-chart-style"})),v("div",{id:"fs-info-tab-cpu",className:"fs-mChart-box"},v("div",{id:"fs-info-cpu-chart",className:"fs-chart-style"})),v("div",{id:"fs-info-tab-disk-usage",className:"fs-mChart-box"},v("div",{id:"fs-info-diskusage-chart",className:"fs-chart-style"})),v("div",{id:"fs-info-tab-loadavg",className:"fs-mChart-box"},v("div",{id:"fs-info-loadavg-chart",className:"fs-chart-style"}))):v("div",{className:"fs-chart-content"},v("div",{className:"fs-charts-width fs-charts-box fs-border"},v("div",{id:"fs-info-memory-chart",className:"fs-chart-style"})),v("div",{className:"fs-charts-width fs-charts-box"},v("div",{id:"fs-info-cpu-chart",className:"fs-chart-style"})),v("div",{className:"fs-charts-width fs-charts-box fs-border"},v("div",{id:"fs-info-diskusage-chart",className:"fs-chart-style"})),v("div",{className:"fs-charts-width fs-charts-box"},v("div",{id:"fs-info-loadavg-chart",className:"fs-chart-style"}))),t=v("div",{className:"flask-state-elem fs-background",id:"fs-background"},v("div",{className:"fs-container-width fs-container",id:"fs-info-container"},v("div",{className:"fs-select-container"},v("svg",{className:"fs-select-arrow",viewBox:"0 0 1024 1024",version:"1.1",width:"29",height:"17"},v("path",{d:"M524.736 548.256l181.248-181.248a51.264 51.264 0 1 1 72.48 72.512l-217.472 217.472a51.264 51.264 0 0 1-72.512 0L271.04 439.52a51.264 51.264 0 1 1 72.512-72.512l181.216 181.248z",fill:"#161e2e"})),v("select",{id:"fs-select-days",className:"fs-select-days"},v("option",{value:"1"},"1"),v("option",{value:"3"},"3"),v("option",{value:"7"},"7"),v("option",{value:"30"},"30")),v("p",{id:"fs-days",className:"fs-days"}," days")),v("button",{type:"button",className:"fs-close",id:"fs-info-close"},v("svg",{viewBox:"0 0 1024 1024",version:"1.1",width:"24",height:"24"},v("path",{d:"M572.16 512l183.466667-183.04a42.666667 42.666667 0 1 0-60.586667-60.586667L512 451.84l-183.04-183.466667a42.666667 42.666667 0 0 0-60.586667 60.586667l183.466667 183.04-183.466667 183.04a42.666667 42.666667 0 0 0 0 60.586667 42.666667 42.666667 0 0 0 60.586667 0l183.04-183.466667 183.04 183.466667a42.666667 42.666667 0 0 0 60.586667 0 42.666667 42.666667 0 0 0 0-60.586667z",fill:"#161e2e"}))),v("h4",{id:"fs-host-status-title",className:"fs-h4-style"},"Host Status"),v("div",{id:"fs-host-status"},v("div",null,v("span",{id:"fs-memory",className:"b-0079cc fs-badge-intro"},"Memory"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-cpu",className:"b-0079cc fs-badge-intro"},"CPU"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-disk-usage",className:"b-0079cc fs-badge-intro"},"Disk Usage"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-load-avg",className:"b-007dc8 fs-badge-intro"},"Load Avg"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-boot-seconds",className:"b-0051b9 fs-badge-intro"},"Uptime"),v("span",{className:"fs-badge-content background-green"}))),v("h4",{id:"fs-redis-status-title",className:"fs-h4-style"},"Redis Status"),v("div",{id:"fs-redis-status"},v("div",null,v("span",{id:"fs-used-memory",className:"b-99cb3d fs-badge-intro"},"Used Mem"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-used-memory-rss",className:"b-99cb3d fs-badge-intro"},"Used Mem Rss"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-mem-fragmentation-ratio",className:"b-534c6d fs-badge-intro"},"Mem Fragmentation Ratio"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-hits-ratio",className:"b-0079cc fs-badge-intro"},"Cache Hits Ratio"),v("span",{className:"fs-badge-content background-green"},"/")),v("div",null,v("span",{id:"fs-delta-hits-ratio",className:"b-0079cc fs-badge-intro"},"24h Hits Ratio"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-uptime-in-seconds",className:"b-0051b9 fs-badge-intro"},"Uptime"),v("span",{className:"fs-badge-content background-green"})),v("div",null,v("span",{id:"fs-connected-clients",className:"b-534c6d fs-badge-intro"},"Connections"),v("span",{className:"fs-badge-content background-green"}))),e));document.body.appendChild(t)},e.prototype.setEventListener=function(){var e=this;window.addEventListener&&(document.getElementById("fs-info-close").addEventListener("click",(function(){document.getElementById("fs-background").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out")})),document.getElementById("fs-background").addEventListener("click",(function(e){var t=e.target;"fs-background"===String(t.id)&&(document.getElementById("fs-background").style.display="none",document.getElementById("fs-info-container").style.display="none",document.getElementsByTagName("body")[0].style.overflowX="auto",document.getElementsByTagName("body")[0].style.overflowY="auto",document.getElementById("fs-state-circular")&&document.getElementById("fs-state-circular").classList.remove("fs-circular-out"))})),document.getElementById("fs-select-days").addEventListener("change",(function(){var t=document.getElementById("fs-select-days");e.setCharts(parseInt(t.value))})))},e.prototype.setTagChangeEventListener=function(){for(var t,a,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(document.getElementById("fs-info-tab")){var i=document.getElementById("fs-info-tab").getElementsByTagName("li"),r=document.getElementById("fs-info-tab-memory"),d=i[0],l=0,c={0:"fs-info-tab-memory",1:"fs-info-tab-cpu",2:"fs-info-tab-disk-usage",3:"fs-info-tab-loadavg"},u=function(t){var a=document.getElementById(c[l]);t.children[0].addEventListener("click",(function(){t.classList.add("active"),d.classList.remove("active"),r.classList.remove("fs-show"),a.classList.add("fs-show"),e.resizeChart(n),r=a,d=t})),l++};try{for(var m=s(i),g=m.next();!g.done;g=m.next()){var f=g.value;u(f)}}catch(e){t={error:e}}finally{try{g&&!g.done&&(a=m.return)&&a.call(m)}finally{if(t)throw t.error}}}},e.prototype.initFlaskStateLanguage=function(){0!==Object.keys(this.language).length&&(document.getElementById("fs-host-status-title").innerHTML=this.language.host_status,document.getElementById("fs-redis-status-title").innerHTML=this.language.redis_status,document.getElementById("fs-cpu").innerHTML=this.language.cpu,document.getElementById("fs-memory").innerHTML=this.language.memory,document.getElementById("fs-disk-usage").innerHTML=this.language.disk_usage,document.getElementById("fs-load-avg").innerHTML=this.language.load_avg,document.getElementById("fs-boot-seconds").innerHTML=this.language.boot_seconds,document.getElementById("fs-used-memory").innerHTML=this.language.used_memory,document.getElementById("fs-used-memory-rss").innerHTML=this.language.used_memory_rss,document.getElementById("fs-mem-fragmentation-ratio").innerHTML=this.language.mem_fragmentation_ratio,document.getElementById("fs-hits-ratio").innerHTML=this.language.hits_ratio,document.getElementById("fs-delta-hits-ratio").innerHTML=this.language.delta_hits_ratio,document.getElementById("fs-uptime-in-seconds").innerHTML=this.language.uptime_in_seconds,document.getElementById("fs-connected-clients").innerHTML=this.language.connected_clients,document.getElementById("fs-days").innerHTML=this.language.days)},e.prototype.setInitParams=function(){this.consoleCpuChart=echarts.init(document.getElementById("fs-info-cpu-chart"),null,{renderer:"svg"}),this.consoleMemoryChart=echarts.init(document.getElementById("fs-info-memory-chart"),null,{renderer:"svg"}),this.consoleLoadavgChart=echarts.init(document.getElementById("fs-info-loadavg-chart"),null,{renderer:"svg"}),this.consoleDiskUsageChart=echarts.init(document.getElementById("fs-info-diskusage-chart"),null,{renderer:"svg"}),this.cpuOption=e.generateChatOption(this.mobile,this.language.cpu||"CPU","",this.language.today||"Today"),this.memoryOption=e.generateChatOption(this.mobile,this.language.memory||"Memory","",this.language.today||"Today"),this.diskUsageOption=e.generateChatOption(this.mobile,this.language.disk_usage||"Disk Usage","",this.language.today||"Today"),this.loadavgOption=e.generateChatOption(this.mobile,"Load Avg","loadavg",this.language.minutes||"min")},e.prototype.setCharts=function(t){var a=this;this.consoleCpuChart.showLoading(),this.consoleMemoryChart.showLoading(),this.consoleLoadavgChart.showLoading(),this.consoleDiskUsageChart.showLoading(),this.ajax.send({type:"POST",url:"/v0/state/hoststatus",data:{timeQuantum:t},success:function(t){var n,c;if(200===t.code){var u=["ts","cpu","memory","load_avg","disk_usage"],m=t.data;m.items=m.items.map((function(e){var t={};return u.forEach((function(a,n){t[a]="ts"===a?1e3*e[n]:e[n]})),t}));var g=m.currentStatistic;if(Object.keys(g).length){var f=document.getElementById("fs-host-status").getElementsByClassName("fs-badge-content");f[0].innerHTML=g.memory+"%",f[1].innerHTML=g.cpu+"%",f[2].innerHTML=g.disk_usage+"%",f[3].innerHTML=g.load_avg[0]+"，"+g.load_avg[1]+"，"+g.load_avg[2],f[4].innerHTML=e.getFormatSeconds(g.boot_seconds||0,a.language.days,a.language.hours,a.language.minutes,a.language.seconds);["memory","cpu","disk_usage","load_avg"].forEach((function(e,t){var a;if("load_avg"===e){var n=(g.load_avg[0]+g.load_avg[1]+g.load_avg[2])/3;a=n>=d?n>=r?"background-red":"background-orange":"background-green"}else a=g[e]>=i?g.memory>=o?"background-red":"background-orange":"background-green";var s=f[t].classList;s.remove("background-green","background-orange","background-red"),s.add(a)}));var h=document.getElementById("fs-redis-status").getElementsByClassName("fs-badge-content"),y=["used_memory","used_memory_rss","mem_fragmentation_ratio","hits_ratio","delta_hits_ratio","uptime_in_seconds","connected_clients"],p=!0;try{for(var v=s(y),b=v.next();!b.done;b=v.next()){var k=b.value;if(g[k]){p=!1;break}}}catch(e){n={error:e}}finally{try{b&&!b.done&&(c=v.return)&&c.call(v)}finally{if(n)throw n.error}}p?(document.getElementById("fs-redis-status-title").innerHTML="",document.getElementById("fs-redis-status-title").style.marginTop="0",document.getElementById("fs-redis-status").style.display="none"):y.forEach((function(t,n){switch(t){case"used_memory":case"used_memory_rss":h[n].innerHTML=Math.ceil(g[t]/l)+" M";break;case"mem_fragmentation_ratio":var s=g[t];if(h[n].innerHTML=g[t],null!=s&&s>1){var o=h[n].classList;o.remove("background-green"),o.add("background-red")}break;case"hits_ratio":case"delta_hits_ratio":h[n].innerHTML=g[t]+"%";break;case"uptime_in_seconds":h[n].innerHTML=e.getFormatSeconds(g[t],a.language.days,a.language.hours,a.language.minutes,a.language.seconds);break;case"connected_clients":h[n].innerHTML=g[t]}}))}m.items.reverse();var _=e.getChartsData(m.items),E=_.ts_list,L=_.cpu_list,C=_.memory_list,N=_.load_avg_list[0],x=_.load_avg_list[1],M=_.load_avg_list[2],T=_.disk_usage_list;a.memoryOption.xAxis.data=E,a.cpuOption.xAxis.data=E,a.loadavgOption.xAxis.data=E,a.diskUsageOption.xAxis.data=E,a.memoryOption.series[0].data=C,a.cpuOption.series[0].data=L,a.diskUsageOption.series[0].data=T,a.loadavgOption.series[0].data=N,a.loadavgOption.series[1].data=x,a.loadavgOption.series[2].data=M,a.consoleMemoryChart.setOption(a.memoryOption),a.consoleCpuChart.setOption(a.cpuOption),a.consoleLoadavgChart.setOption(a.loadavgOption),a.consoleDiskUsageChart.setOption(a.diskUsageOption),e.resizeChart([a.consoleMemoryChart,a.consoleCpuChart,a.consoleLoadavgChart,a.consoleDiskUsageChart])}},complete:function(){a.consoleMemoryChart.hideLoading(),a.consoleCpuChart.hideLoading(),a.consoleLoadavgChart.hideLoading(),a.consoleDiskUsageChart.hideLoading()}}).then()},e.prototype.resizeChartTimer=function(t){clearTimeout(this.clearId),this.clearId=setTimeout((function(){e.resizeChart(t)}),200)},e.isMobile=function(){var e=navigator.userAgent,t={trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&-1===e.indexOf("KHTML"),mobile:e.match(/AppleWebKit.*Mobile.*/)&&!0,ios:e.match(/\(i[^;]+;( U;)? CPU.Mac OS X/)&&!0,android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:-1===e.indexOf("Safari"),wechat:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)&&" qq"===e.match(/\sQQ/i)[0]};return t.iPhone||t.iPad||t.webApp||t.wechat||t.qq||t.ios||t.mobile||!1},e.resizeChart=function(e){e.forEach((function(e){return e.resize()}))},e.generateChatOption=function(e,t,a,n){void 0===a&&(a=""),void 0===n&&(n="");var s={color:"loadavg"===a?["#ffa726","#42a5f5","#66bb6a"]:["#42a5f5"],title:{show:!e,text:t},tooltip:{trigger:"axis",formatter:function(e){for(var t=echarts.format.formatTime("yyyy-MM-dd hh:mm:ss",new Date(parseInt(e[0].axisValue)),!1)+"<br />",n=0;n<e.length;n++)t+=e[n].marker+e[n].seriesName+": "+e[n].value+("loadavg"===a?"":"%")+"<br />";return t}},legend:{data:[n],textStyle:{fontSize:14}},grid:{left:"3%",right:"4%",bottom:"3%",top:e?30:60,containLabel:!0},toolbox:{show:!e,feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,axisLabel:{formatter:function(e){return echarts.format.formatTime("hh:mm",new Date(parseInt(e)),!1)}}},yAxis:{type:"value"},series:[{name:n,type:"line",symbol:"none",hoverAnimation:!1}]};return"loadavg"===a&&(s.legend.data=["1 "+n,"5 "+n,"15 "+n],s.series=[],s.legend.data.forEach((function(e){s.series.push({name:e,type:"line",symbol:"none",hoverAnimation:!1})}))),s},e.getChartsData=function(e){for(var t=[],a=[],n=[],s=[],o=[],i=[],r=[],d=0;d<e.length;d++){var l=e[d];t.push(l.cpu),a.push(l.disk_usage),n.push(l.load_avg[0]),s.push(l.load_avg[1]),o.push(l.load_avg[2]),i.push(l.memory),r.push(l.ts)}return{cpu_list:t,disk_usage_list:a,load_avg_list:[n,s,o],memory_list:i,ts_list:r}},e.getFormatSeconds=function(e,t,a,n,s){void 0===t&&(t="days"),void 0===a&&(a="hours"),void 0===n&&(n="min"),void 0===s&&(s="seconds");var o=parseInt(e),i=0,r=0,d=0,l="";return o>=60?((i=o/60)>=60&&(r=i/60,i%=60),r>=24&&(d=r/24,r%=24)):l=o+s,i>0&&(l=Math.floor(i)+" "+n),r>0&&(l=Math.floor(r)+" "+a),d>0&&(l=Math.floor(d)+" "+t),l},e}(),m=function(){function e(){this.xhr=new XMLHttpRequest}return e.prototype.send=function(e){var t=this.xhr,a={type:e.type||"get",url:e.url||"",async:e.async||!0,data:JSON.stringify(e.data),dataType:e.dataType||"json",contentType:"application/json",success:e.success||null,complete:e.complete||null};return new Promise((function(e,n){t.open(a.type,a.url,a.async),t.onreadystatechange=function(){if(4===t.readyState)if("json"===a.dataType){var s=JSON.parse(t.responseText);e(s),null!==a.success?a.success(s):n(new Error(String(t.status)||"No callback function."))}else n(new Error(String(t.status)||"Error data type."))},t.onerror=function(){n(new Error(String(t.status)||"Server is fail."))},t.setRequestHeader("Content-type",a.contentType),t.send(a.data),t.onloadend=function(){null!=a.complete&&a.complete()}}))},e}();function g(e){document.getElementById("fs-state-circular").style.top=e.clientY-c+300+"px"}var f,h=(f=null,function(e){return f||(f=new u(e))});function y(e,t){return Boolean(e)?e:t}function p(e,t,a){var n=document.createElement(e);return Object.keys(y(t,{})).forEach((function(e){n[e]=t[e]})),function(e){return e.map((function(e){return"string"==typeof e?document.createTextNode(e):e}))}(a).forEach((function(e){n.appendChild(e)})),n}function v(e,t){for(var a=[],s=2;s<arguments.length;s++)a[s-2]=arguments[s];return"function"==typeof e?e(n(n({},y(t,{})),{children:a})):p(e,t,a)}t.init=function(e){var t,a={};if(null!==e&&"object"==typeof e&&(t=e.hasOwnProperty("dom")?e.dom:null,a=e.hasOwnProperty("lang")&&e.lang.hasOwnProperty("language")?e.lang:{}),t instanceof HTMLElement){if(t.getAttribute("flaskState"))return;t.setAttribute("flaskState","true"),t.addEventListener("click",(function(){return h(a).setFlaskStateData()}))}else{if(document.getElementById("fs-state-circular"))return;document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend","<div id='fs-state-circular' class='fs-circular' style='top:300px;border-radius:100px;opacity:0.3;border:2px solid purple;'></div>");var n=document.getElementById("fs-state-circular");n.onclick=function(){n.classList.add("fs-circular-out"),h(a).setFlaskStateData()},n.onmousedown=function(e){c=c||e.clientY,document.addEventListener("mousemove",g)},document.onmouseup=function(){document.removeEventListener("mousemove",g);var e=parseInt(n.style.top);n.classList.add("fs-circular-animation"),n.style.top=Math.min(Math.max(e,50),window.screen.height-200)+"px",setTimeout((function(){return n.classList.remove("fs-circular-animation")}),500)}}}}])}));